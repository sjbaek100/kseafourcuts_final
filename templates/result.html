<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>final</title>
<link rel="stylesheet" href="{{ url_for('static', filename='result.css') }}">
<link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}">
</head>
<body onload="showLoading()">

<h2>Preview | ë¯¸ë¦¬ë³´ê¸°</h2>
<div class="resulting">
    <div class="final_image">
        {% set final_image = request.args.get('final_image') %}
        {% set session_folder = final_image.split('/')[1] %}
        {% set static_folder = 'static/photos/' + session_folder %}

        {% if final_image %}
            {% set filename = final_image.split('/')[-1] %}
            <img src="{{ url_for('static', filename=final_image.replace('static/', '')) }}" alt="ìµœì¢… ì´ë¯¸ì§€">

            <div class="btn-box">
                <a href="{{ url_for('download_file', session=session_folder, filename=filename) }}"></a>
            </div>
        {% else %}
            <img class="errorphoto" src="{{ url_for('static', filename='photos/20250331_174125/final.jpg') }}" alt="ì—ëŸ¬ ì´ë¯¸ì§€">
        {% endif %}
            </div>

    <div class="instruction">
        <div id="loading" class="loading-inline" style="display: flex;">
            <div class="spinner"></div>
            <p>Printing ... | ì¶œë ¥ ì¤‘ ...</p>
        </div>
        <div class="para">
            <p>
                Please wait outside, and once the printing is complete, the staff will bring you your photo.
                <br><span style="color:#3954A6;">You can download the image file via QR code after 6 pm today.</span>
                <br>Weâ€™d love to see you again!
                <br><br><br>ë°–ì—ì„œ ì ì‹œ ê¸°ë‹¤ë ¤ ì£¼ì‹œë©´, í”„ë¦°íŠ¸ê°€ ì™„ë£Œëœ í›„ ë‹´ë‹¹ ì„ì›ì´ ì‚¬ì§„ì„ ì „ë‹¬í•´ ë“œë¦´ ì˜ˆì •ì…ë‹ˆë‹¤.
                <br><span style="color:#3954A6;">QR ì½”ë“œë¥¼ í†µí•´ ì´ë¯¸ì§€ íŒŒì¼ì„ ì˜¤ëŠ˜ ì˜¤í›„ 6ì‹œ ì´í›„ì— ë‹¤ìš´ë¡œë“œí•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</span>
                <br>ì˜¤ëŠ˜ ë°©ë¬¸í•´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤. <br>ì €í¬ ì´ë²¤íŠ¸ë„ ë§ì€ ê´€ì‹¬ ë¶€íƒë“œë¦½ë‹ˆë‹¤!
            </p>
        </div>
    </div>
</div>

<div class="back-button">
    <form action="{{ url_for('start') }}" method="get">
        <button type="submit" class="styled-button">ì²˜ìŒìœ¼ë¡œ</button>
    </form>
</div>    

<script>
    window.onload = function () {
        const imagePath = "{{ static_folder }}/final_with_qr.jpg";
        if (!imagePath) {
            console.warn("âš ï¸ ì´ë¯¸ì§€ ê²½ë¡œ ì—†ìŒ. í”„ë¦°íŠ¸ ìš”ì²­ ì•ˆ ë³´ëƒ„");
            return;
        }

        // í”„ë¦°íŠ¸ ìš”ì²­
        fetch('/print', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ path: imagePath })
        })
        .then(res => res.json())
        .then(data => {
            if (data.success) {
                console.log("ğŸ–¨ï¸ í”„ë¦°íŠ¸ ìš”ì²­ ì„±ê³µ");
            } else {
                console.error("âŒ í”„ë¦°íŠ¸ ì‹¤íŒ¨:", data.error);
            }
        })
        .catch(err => {
            console.error("âš ï¸ í”„ë¦°íŠ¸ ìš”ì²­ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", err);
        });
    };
</script>

</body>
</html>
